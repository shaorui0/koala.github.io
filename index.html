<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Justin Shao&#39;s Space">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Justin Shao&#39;s Space">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Justin Shao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Justin Shao's Space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Justin Shao's Space</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/27/cicd_process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/27/cicd_process/" class="post-title-link" itemprop="url">CI/CD process</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-27 22:31:00 / Modified: 23:14:39" itemprop="dateCreated datePublished" datetime="2024-11-27T22:31:00+08:00">2024-11-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre class="mermaid">graph TD
    A[Developer writes and commits code] --> B[Push code to GitHub]
    B --> C[GitHub triggers Jenkins via Webhook]
    C --> D[Clone repository to Jenkins workspace]
    D --> E[Run CI Pipeline]

    subgraph CI
        E1[Build Code]
        E2[Run Unit Tests]
        E3[Static Code Analysis]
        E4[Package Build Artifacts]
    end

    E --> E1 --> E2 --> E3 --> E4 --> F[Store Build Artifacts in Artifact Repository]
    F --> G[Deploy to Staging Environment]

    subgraph CD
        G1[Run Smoke Tests]
        G2[Deploy to Production]
        G3[Run Acceptance Tests]
    end

    G --> G1 --> G2 --> G3 --> H[Notify Team of Deployment Status]

    H --> I[Monitor Application Performance]
    I --> J[Feedback to Development Team]</pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/11/27/cicd_process/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/27/shell_commands_table/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/27/shell_commands_table/" class="post-title-link" itemprop="url">Shell commands table</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-27 22:30:00 / Modified: 23:11:41" itemprop="dateCreated datePublished" datetime="2024-11-27T22:30:00+08:00">2024-11-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Category</strong></th>
<th><strong>Command</strong></th>
<th><strong>Sub-command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>File Operations and Text Processing</strong></td>
<td><code>cat</code></td>
<td><code>cat filename</code></td>
<td>Displays the contents of <code>filename</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>cat file1 file2 &gt; combined_file</code></td>
<td>Concatenates <code>file1</code> and <code>file2</code> into <code>combined_file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>grep</code></td>
<td><code>grep "pattern" file</code></td>
<td>Searches for "pattern" in <code>file</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>grep -r "pattern" directory/</code></td>
<td>Recursively searches for "pattern" in <code>directory</code> and its subdirectories.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>grep -i "pattern" file</code></td>
<td>Searches for "pattern" in <code>file</code> case-insensitively.</td>
</tr>
<tr class="even">
<td></td>
<td><code>sed</code></td>
<td><code>sed 's/old/new/g' file</code></td>
<td>Replaces all occurrences of "old" with "new" in <code>file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>sed -i '1d' file</code></td>
<td>Deletes the first line of <code>file</code> in place.</td>
</tr>
<tr class="even">
<td></td>
<td><code>awk</code></td>
<td><code>awk -F"\\t" '&#123;print $8&#125;' file</code></td>
<td>Prints the 8th column of a tab-separated <code>file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>awk '&#123;sum += $1&#125; END &#123;print sum&#125;' file</code></td>
<td>Sums the first column of <code>file</code> and prints the total.</td>
</tr>
<tr class="even">
<td></td>
<td><code>sort</code></td>
<td><code>sort file</code></td>
<td>Sorts the lines in <code>file</code> alphabetically.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>sort -t $'\\t' -k 2 file</code></td>
<td>Sorts <code>file</code> based on the second tab-separated column.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>sort -t $'\\t' -rk 2 file</code></td>
<td>Sorts <code>file</code> in reverse order based on the second tab-separated column.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>uniq</code></td>
<td><code>uniq file</code></td>
<td>Removes duplicate lines from <code>file</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>uniq -c file</code></td>
<td>Counts the number of occurrences of each line in <code>file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>split</code></td>
<td><code>split -l 10000 file.txt</code></td>
<td>Splits <code>file.txt</code> into smaller files with 10,000 lines each.</td>
</tr>
<tr class="even">
<td></td>
<td><code>wc</code></td>
<td><code>wc -l file</code></td>
<td>Counts the number of lines in <code>file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>wc -w file</code></td>
<td>Counts the number of words in <code>file</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>join</code></td>
<td><code>join file1 file2</code></td>
<td>Joins lines of <code>file1</code> and <code>file2</code> on a common field.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>head</code></td>
<td><code>head -n 100 filename</code></td>
<td>Displays the first 100 lines of <code>filename</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>tail</code></td>
<td><code>tail -n +1000 filename</code></td>
<td>Displays lines starting from line 1000 of <code>filename</code>.</td>
</tr>
<tr class="odd">
<td><strong>Data Statistics and Analysis</strong></td>
<td><code>xargs</code></td>
<td><code>ls | xargs grep "pattern"</code></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>tee</code></td>
<td><code>command | tee file</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>command | tee -a file</code></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Compression and Archiving</strong></td>
<td><code>gzip</code></td>
<td><code>gzip filename</code></td>
<td>Compresses <code>filename</code> using the gzip algorithm.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>gzip -d filename.gz</code></td>
<td>Decompresses <code>filename.gz</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>tar</code></td>
<td><code>tar -cvf archive.tar /path/to/directory</code></td>
<td>Creates a tar archive without compression.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>tar -zcvf archive.tar.gz /path/to/directory</code></td>
<td>Creates a tar archive with gzip compression.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>tar -xf archive.tar -C /destination</code></td>
<td>Extracts a tar archive to the specified destination.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>tar -xzf archive.tar.gz -C /destination</code></td>
<td>Extracts a gzip-compressed tar archive to the specified destination.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>tar -cvf archive.tar /path --exclude=*log* --exclude=*data*</code></td>
<td>Creates a tar archive while excluding files matching patterns.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>zip</code></td>
<td><code>zip archive.zip file1 file2</code></td>
<td>Compresses <code>file1</code> and <code>file2</code> into <code>archive.zip</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>zip -r archive.zip directory/</code></td>
<td>Recursively compresses <code>directory</code> into <code>archive.zip</code>.</td>
</tr>
<tr class="odd">
<td><strong>Data Flow and Process Management</strong></td>
<td><code>ps</code></td>
<td><code>ps aux --sort=-%mem</code></td>
<td>Lists processes sorted by memory usage.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>ps -ef</code></td>
<td>Displays all running processes.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>ps -eaf</code></td>
<td>Another variant to display all processes.</td>
</tr>
<tr class="even">
<td></td>
<td><code>top</code></td>
<td><code>top</code></td>
<td>Displays real-time system processes and resource usage.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>kill</code></td>
<td><code>kill -9 $pid</code></td>
<td>Forcefully terminates a process with the specified PID.</td>
</tr>
<tr class="even">
<td></td>
<td><code>pgrep</code></td>
<td><code>pgrep process_name</code></td>
<td>Searches for processes by name and returns their PIDs.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>bg</code></td>
<td><code>bg %job</code></td>
<td>Resumes a suspended job in the background.</td>
</tr>
<tr class="even">
<td></td>
<td><code>jobs</code></td>
<td><code>jobs</code></td>
<td>Lists active jobs in the current shell.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>nohup</code></td>
<td><code>nohup command &gt; output.log 2&gt;&amp;1 &amp;</code></td>
<td>Runs <code>command</code> immune to hangups, redirecting output to <code>output.log</code> and running it in the background.</td>
</tr>
<tr class="even">
<td><strong>Network and File Transfer</strong></td>
<td><code>wget</code></td>
<td><code>wget &lt;http://example.com/file.zip</code>&gt;</td>
<td>Retrieves <code>file.zip</code> from the specified URL.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>wget -O output.txt &lt;http://example.com/data</code>&gt;</td>
<td>Downloads data from the specified URL and saves it as <code>output.txt</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>scp</code></td>
<td><code>scp file.txt user@remote:/path/</code></td>
<td>Securely copies <code>file.txt</code> to a remote host.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scp -r /local/dir user@remote:/path/</code></td>
<td>Securely copies a directory recursively to a remote host.</td>
</tr>
<tr class="even">
<td></td>
<td><code>netstat</code></td>
<td><code>netstat -tunpl \| grep [port]</code></td>
<td>Lists listening ports and associated processes.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>netstat -nap \| grep [pid]</code></td>
<td>Shows network connections for a specific PID.</td>
</tr>
<tr class="even">
<td></td>
<td><code>nc</code> (netcat)</td>
<td><code>nc -zv host port</code></td>
<td>Scans <code>host</code> on <code>port</code> to check if it's open.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>nc host port</code></td>
<td>Connects to <code>host</code> on <code>port</code> for data transfer or communication.</td>
</tr>
<tr class="even">
<td><strong>System Information and Monitoring</strong></td>
<td><code>df</code></td>
<td><code>df -h</code></td>
<td>Reports file system disk space usage in a human-readable format.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>df -T</code></td>
<td>Shows the type of file system.</td>
</tr>
<tr class="even">
<td></td>
<td><code>du</code></td>
<td><code>du -h --max-depth=1</code></td>
<td>Displays disk usage in a human-readable format, limited to one directory level.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>du -sh test_dir</code></td>
<td>Shows the total disk usage of <code>test_dir</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>iostat</code></td>
<td><code>iostat</code></td>
<td>Reports CPU and I/O statistics for devices and partitions.</td>
</tr>
<tr class="odd">
<td><strong>File Search</strong></td>
<td><code>find</code></td>
<td><code>find . -name "*.log"</code></td>
<td>Searches for all <code>.log</code> files in the current directory and subdirectories.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>find /path -type f -size +100M</code></td>
<td>Finds files larger than 100MB in <code>/path</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>which</code></td>
<td><code>which gcc</code></td>
<td>Locates the executable path for <code>gcc</code>.</td>
</tr>
<tr class="even">
<td><strong>Permission Management</strong></td>
<td><code>chmod</code></td>
<td><code>chmod u+r file</code></td>
<td>Adds read permission for the user on <code>file</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>chmod o-r file</code></td>
<td>Removes read permission for others on <code>file</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>chmod 755 script.sh</code></td>
<td>Sets permissions to rwxr-xr-x for <code>script.sh</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>chown</code></td>
<td><code>chown user:group file</code></td>
<td>Changes ownership of <code>file</code> to <code>user</code> and <code>group</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>chown -R user:group directory/</code></td>
<td>Recursively changes ownership of <code>directory</code> and its contents to <code>user</code> and <code>group</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>ls -l</code></td>
<td><code>ls -l</code></td>
<td>Lists directory contents in long format, showing permissions and ownership.</td>
</tr>
<tr class="even">
<td><strong>Other Tools</strong></td>
<td><code>env</code></td>
<td><code>env</code></td>
<td>Displays the current environment variables.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>env VAR=value command</code></td>
<td>Sets an environment variable <code>VAR</code> to <code>value</code> for the duration of <code>command</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>date</code></td>
<td><code>date</code></td>
<td>Displays the current date and time.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>date +"%Y-%m-%d"</code></td>
<td>Outputs the date in YYYY-MM-DD format.</td>
</tr>
<tr class="even">
<td></td>
<td><code>watch</code></td>
<td><code>watch -n 1 ls</code></td>
<td>Executes <code>ls</code> every second, updating the display.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>alias</code></td>
<td><code>alias ll='ls -al'</code></td>
<td>Creates an alias <code>ll</code> for <code>ls -al</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>alias gs='git status'</code></td>
<td>Creates an alias <code>gs</code> for <code>git status</code>.</td>
</tr>
<tr class="odd">
<td><strong>Advanced Tools</strong></td>
<td><code>jq</code></td>
<td><code>jq '.' file.json</code></td>
<td>Parses and formats JSON data from <code>file.json</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>jq '.key' file.json</code></td>
<td>Extracts the value of <code>key</code> from <code>file.json</code>.</td>
</tr>
<tr class="odd">
<td><strong>Network Configuration and Management</strong></td>
<td><code>netplan</code></td>
<td><code>netplan apply</code></td>
<td>Applies the network configuration defined in Netplan YAML files.</td>
</tr>
<tr class="even">
<td></td>
<td><code>ip</code></td>
<td><code>ip addr add 10.240.224.117/24 dev ens9f0</code></td>
<td>Adds an IP address to the network interface <code>ens9f0</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>ip route add default via 10.240.224.1</code></td>
<td>Adds a default gateway route via <code>10.240.224.1</code>.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>ip a sh dev ens1f0</code></td>
<td>Shows the address information for the device <code>ens1f0</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>ip l s ens1f0 up</code></td>
<td>Sets the link state of <code>ens1f0</code> to up.</td>
</tr>
<tr class="even">
<td></td>
<td><code>ifconfig</code></td>
<td><code>ifconfig up ens9f0</code></td>
<td>Brings up the network interface <code>ens9f0</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>ifconfig ens9f0</code></td>
<td>Displays the configuration of the network interface <code>ens9f0</code>.</td>
</tr>
<tr class="even">
<td><strong>Networking Utilities</strong></td>
<td><code>nslookup</code></td>
<td><code>nslookup child-prc.intel.com</code></td>
<td>Queries DNS to obtain domain name information for <code>child-prc.intel.com</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/06/delve_into_prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/06/delve_into_prometheus/" class="post-title-link" itemprop="url">Delve into prometheus</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-06 20:17:00 / Modified: 22:40:35" itemprop="dateCreated datePublished" datetime="2024-11-06T20:17:00+08:00">2024-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="introduction-to-time-series-data">1. Introduction to Time Series Data</h2>
<p><strong>TL;DR</strong></p>
<p>Time series data is a sequence of data points collected or recorded at specific time intervals, typically used to track changes or trends over time.</p>
<p><strong>Data Schema</strong></p>
<ul>
<li>Structure: <code>identifier -&gt; (t0, v0), (t1, v1), (t2, v2), ...</code></li>
</ul>
<p><strong>Data in Prometheus</strong></p>
<ul>
<li>Format: <code>&lt;metric_name&gt;&#123;&lt;label_name&gt;=&lt;label_value&gt;, ...&#125;</code></li>
</ul>
<p>Example of a typical set of series identifiers (data model):</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123; <span class="attr">&quot;__name__&quot;</span>: <span class="string">&quot;http_requests_total&quot;</span>, <span class="attr">&quot;pod&quot;</span>: <span class="string">&quot;example-pod&quot;</span>, <span class="attr">&quot;job&quot;</span>: <span class="string">&quot;example-job&quot;</span>, <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/api/v1/resource&quot;</span>, <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;GET&quot;</span>&#125; @<span class="number">1430000000</span> <span class="number">94355</span></span><br><span class="line">&#123; <span class="attr">&quot;__name__&quot;</span>: <span class="string">&quot;http_requests_total&quot;</span>, <span class="attr">&quot;pod&quot;</span>: <span class="string">&quot;example-pod&quot;</span>, <span class="attr">&quot;job&quot;</span>: <span class="string">&quot;example-job&quot;</span>, <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/api/v1/resource&quot;</span>, <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;PUT&quot;</span>&#125; @<span class="number">1435000000</span> <span class="number">94355</span></span><br><span class="line">&#123; <span class="attr">&quot;__name__&quot;</span>: <span class="string">&quot;http_requests_total&quot;</span>, <span class="attr">&quot;pod&quot;</span>: <span class="string">&quot;example-pod&quot;</span>, <span class="attr">&quot;job&quot;</span>: <span class="string">&quot;example-job&quot;</span>, <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/api/v1/resource&quot;</span>, <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>&#125; @<span class="number">1439999999</span> <span class="number">94355</span></span><br></pre></td></tr></table></figure>
<p><strong>Components:</strong></p>
<ul>
<li><strong>Key: Series</strong>
<ul>
<li><strong>Metric Name:</strong> <code>__name__</code></li>
<li><p><strong>Labels:</strong></p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;pod&quot;</span>: <span class="string">&quot;example-pod&quot;</span>, <span class="attr">&quot;job&quot;</span>: <span class="string">&quot;example-job&quot;</span>, <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/api/v1/resource&quot;</span>, <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;GET&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><strong>Timestamp:</strong> Recorded time of the sample</li>
</ul></li>
<li><strong>Value:</strong> Sample value</li>
</ul>
<p><strong>How to Query:</strong></p>
<ul>
<li>Example Queries:
<ul>
<li><code>__name__="http_requests_total"</code> - Selects all series belonging to the <code>http_requests_total</code> metric</li>
<li><code>method="PUT|POST"</code> - Selects all series where the method is either PUT or POST</li>
</ul></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/11/06/delve_into_prometheus/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/06/diff_ha_and_reliability/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/06/diff_ha_and_reliability/" class="post-title-link" itemprop="url">HA v.s. Reliability</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-06 20:17:00 / Modified: 22:43:17" itemprop="dateCreated datePublished" datetime="2024-11-06T20:17:00+08:00">2024-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>High Availability (HA) and Reliability are two important concepts in system design, but they address different aspects of system performance and robustness. Below, I'll provide code examples and explanations to illustrate the differences between HA and Reliability.</p>
<h3 id="high-availability-ha"><strong>High Availability (HA)</strong></h3>
<p>High Availability focuses on ensuring that a system is operational and accessible for as much time as possible. This often involves redundancy and failover mechanisms to minimize downtime.</p>
<h3 id="example-high-availability-with-load-balancer-and-multiple-instances"><strong>Example: High Availability with Load Balancer and Multiple Instances</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*<span class="comment"># Example using Flask and Gunicorn for a web application# app.py*</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/11/06/diff_ha_and_reliability/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/06/why_name_reconcile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/06/why_name_reconcile/" class="post-title-link" itemprop="url">why the function of controller in kubernete operator is called "reconcile"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-06 20:17:00 / Modified: 22:37:25" itemprop="dateCreated datePublished" datetime="2024-11-06T20:17:00+08:00">2024-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In Kubernetes, the term "reconcile" is used to describe the process by which an operator controller ensures that the current state of a resource matches the desired state specified by the user.</p>
<p>The name "reconcile" is derived from the concept of reconciliation, which means to make consistent or congruent.</p>
<ol type="1">
<li><strong>Desired State vs. Current State</strong>:
<ul>
<li>Kubernetes operates on a declarative model where users specify the desired state of the system using YAML or JSON manifests.</li>
<li>The actual state of the system is the current state of the resources as observed in the cluster.</li>
</ul></li>
<li><strong>Reconciliation Loop</strong>:
<ul>
<li>The core responsibility of a Kubernetes controller (including operators) is to continuously monitor the current state of resources and compare it with the desired state.</li>
<li>If there is a discrepancy between the desired state and the current state, the controller takes actions to bring the current state in line with the desired state. This process is known as reconciliation.</li>
</ul></li>
<li><strong>Reconcile Function</strong>:
<ul>
<li>The "reconcile" function is the heart of this process. It is called whenever there is a change in the resource or periodically to ensure the desired state is maintained.</li>
<li>The function typically involves reading the current state of the resource, comparing it with the desired state, and then performing the necessary operations (such as creating, updating, or deleting resources) to reconcile the two states.</li>
</ul></li>
<li><strong>Idempotency</strong>:
<ul>
<li>The reconcile function is designed to be idempotent, meaning that running it multiple times with the same input should produce the same result. This ensures that the system remains stable and consistent even if the function is triggered multiple times.</li>
</ul></li>
<li><strong>Event-Driven</strong>:
<ul>
<li>The reconciliation process is often event-driven. When a resource changes (e.g., a new pod is created, or a deployment is updated), an event is generated, and the reconcile function is triggered to handle the change.</li>
</ul></li>
</ol>
<p>In summary, the name "reconcile" aptly describes the function's role in ensuring that the <strong>actual state</strong> of the system matches the <strong>desired state</strong> as defined by the user. It reflects the continuous and iterative nature of the process, where the controller works to "reconcile" any differences between the two states.</p>
<pre class="mermaid">graph TD
    A[User Request] -->|kubectl| B[API Server]
    B --> C[etcd]
    B --> D[Controller Manager]
    D -->|Reconcile Loop| E[Custom Controller]
    E -->|Check Desired State| F[etcd]
    E -->|Check Current State| G[API Server]
    E -->|Update Resources| H[Scheduler]
    H --> I[Nodes]
    I -->|Run Pods| J[Actual State]
    J -->|Report Status| G
    G -->|Update Status| F
    F -->|Store State| C</pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/11/06/why_name_reconcile/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/31/todo_kafka_cluster/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/31/todo_kafka_cluster/" class="post-title-link" itemprop="url">Kafka cluster networking</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-10-31 11:00:00 / Modified: 19:52:47" itemprop="dateCreated datePublished" datetime="2024-10-31T11:00:00+08:00">2024-10-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre class="mermaid">graph TB
    subgraph "Kafka Cluster"
        Broker1["Broker 1"]
        Broker2["Broker 2"]
        Broker3["Broker 3"]
    end

    subgraph "Topic: my-topic (3 Partitions)"
        P0["Partition 0"]
        P1["Partition 1"]
        P2["Partition 2"]
    end

    P0 --> LeaderP0["Leader (Broker 1)"]
    P0 --> FollowerP0_B2["Follower (Broker 2)"]
    P0 --> FollowerP0_B3["Follower (Broker 3)"]

    P1 --> LeaderP1["Leader (Broker 2)"]
    P1 --> FollowerP1_B3["Follower (Broker 3)"]
    P1 --> FollowerP1_B1["Follower (Broker 1)"]

    P2 --> LeaderP2["Leader (Broker 3)"]
    P2 --> FollowerP2_B1["Follower (Broker 1)"]
    P2 --> FollowerP2_B2["Follower (Broker 2)"]

    Producer["Producer"] -->|Write to Leader| LeaderP0
    Producer -->|Write to Leader| LeaderP1
    Producer -->|Write to Leader| LeaderP2

    ConsumerGroup1["Consumer Group 1"] -->|Consume from Partition 0| LeaderP0
    ConsumerGroup1 -->|Consume from Partition 1| LeaderP1
    ConsumerGroup1 -->|Consume from Partition 2| LeaderP2

    ConsumerGroup2["Consumer Group 2"] -->|Consume from Partition 0| LeaderP0
    ConsumerGroup2 -->|Consume from Partition 1| LeaderP1
    ConsumerGroup2 -->|Consume from Partition 2| LeaderP2

    Zookeeper["ZooKeeper / KRaft"] -->|Manage Metadata & Leader Election| Broker1
    Zookeeper --> Broker2
    Zookeeper --> Broker3</pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/29/request_process_via_operator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/29/request_process_via_operator/" class="post-title-link" itemprop="url">Outside network request access the k8s operator</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-29 22:57:00" itemprop="dateCreated datePublished" datetime="2024-10-29T22:57:00+08:00">2024-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-06 21:40:52" itemprop="dateModified" datetime="2024-11-06T21:40:52+08:00">2024-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>how does the outside (cluster) network request access the k8s operator and final the operator handle the process? answer the process in low level, suck as tcp/ip, k8s service mechanism, CRD, operator reconcile, manager and controller in operator, etc</p>
<p><img src="/images/operator_process.png" /></p>
<pre class="mermaid">flowchart TD
  A[External Request] --> B[DNS Resolution]
  B --> C[TCP/IP Connection Established]
  C --> D[Load Balancer / Ingress Controller]

  D --> E[Kubernetes Service]
  E --> F[Forward Request to Operator Pod]

  subgraph Operator Pod Components
    F --> G[Operator Manager]
    G --> H[Controller Watches CRD Changes]
    H --> I[Reconciliation Loop]
    I --> J[Current State Assessment]
    J --> K[Compute Difference]
    K --> L[Execute Changes to Reach Desired State]
  end

  I --> Z[Sync State with CRD]
  L --> Z</pre>
<p>To understand how an external network request reaches a Kubernetes (k8s) operator and how the operator processes it, we need to dissect the journey step by step, focusing on the underlying mechanisms like TCP/IP, Kubernetes services, Custom Resource Definitions (CRDs), and the internal workings of an operator, including the reconcile loop, managers, and controllers.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/10/29/request_process_via_operator/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/29/loki_storage_optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/29/loki_storage_optimization/" class="post-title-link" itemprop="url">Loki Storage Optimization</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-29 22:30:00" itemprop="dateCreated datePublished" datetime="2024-10-29T22:30:00+08:00">2024-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-06 21:41:12" itemprop="dateModified" datetime="2024-11-06T21:41:12+08:00">2024-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="use-coldhot-storage-separation"><strong>1. Use Cold/Hot Storage Separation</strong></h2>
<h3 id="approach">Approach:</h3>
<ul>
<li><strong>Hot Data</strong> (logs from the last few days or weeks): Stored in <strong>fast storage</strong> (like SSDs) for frequent access.</li>
<li><strong>Cold Data</strong> (historical logs): Stored in <strong>object storage</strong> (like MinIO, S3) for long-term archiving and infrequent access.</li>
</ul>
<h3 id="example-loki-configuration">Example Loki Configuration:</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage_config:</span></span><br><span class="line">  <span class="attr">boltdb_shipper:</span></span><br><span class="line">    <span class="attr">active_index_directory:</span> <span class="string">/var/loki/index</span>  <span class="comment"># Hot data directory</span></span><br><span class="line">    <span class="attr">shared_store:</span> <span class="string">s3</span>  <span class="comment"># Use MinIO/S3 as cold data storage</span></span><br><span class="line">    <span class="attr">cache_location:</span> <span class="string">/var/loki/cache</span>  <span class="comment"># Cache directory</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">aws:</span></span><br><span class="line">    <span class="attr">s3:</span> <span class="string">http://minio-service.minio.svc.cluster.local:9000</span>  <span class="comment"># Address of MinIO</span></span><br><span class="line">    <span class="attr">bucketnames:</span> <span class="string">loki-logs</span></span><br><span class="line">    <span class="attr">access_key_id:</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">secret_access_key:</span> <span class="string">minio123</span></span><br></pre></td></tr></table></figure>
<h3 id="optimization-effect">Optimization Effect:</h3>
<ul>
<li>Reduces local storage pressure by moving historical logs to <strong>object storage</strong>.</li>
<li>Improves query performance: prioritizes hot data queries, with slightly higher latency for cold data queries but at lower costs.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/10/29/loki_storage_optimization/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/29/monitoring_loki/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/29/monitoring_loki/" class="post-title-link" itemprop="url">Monitoring the Loki Logging System</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-10-29 21:57:00 / Modified: 21:38:09" itemprop="dateCreated datePublished" datetime="2024-10-29T21:57:00+08:00">2024-10-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="monitoring-the-loki-logging-system">Monitoring the Loki Logging System</h1>
<p>In a high-concurrency environment where Loki handles intensive log processing and storage, monitoring metrics are essential for ensuring system stability, performance optimization, and dynamically adjusting configurations (such as replicas and sharding). Here are the main Loki component metrics you can monitor to dynamically adjust system settings as needed:</p>
<h3 id="loki-ingester-metrics">1. <strong>Loki Ingester Metrics</strong></h3>
<ul>
<li><p><strong><code>loki_ingester_memory_usage_bytes</code></strong>:</p>
<p>Monitors memory usage for each Ingester instance. If memory usage remains close to system limits, consider increasing the number of Ingester replicas to distribute the load.</p>
<ul>
<li><strong>Purpose</strong>: Dynamically scale up or down the number of Ingester replicas based on memory usage.</li>
</ul></li>
<li><p><strong><code>loki_ingester_wal_fsync_duration_seconds</code></strong>:</p>
<p>Monitors the time each Ingester instance takes to write WAL (Write-Ahead Log) data to disk. High write durations may indicate that write throughput is nearing its limit; consider expanding sharding or increasing storage bandwidth.</p>
<ul>
<li><strong>Purpose</strong>: Use WAL write latency to determine if scaling or storage optimization is needed.</li>
</ul></li>
<li><p><strong><code>loki_ingester_chunk_store_writes_total</code></strong> and <strong><code>loki_ingester_chunk_store_reads_total</code></strong>:</p>
<p>Monitors the total number of chunk reads and writes. If write volume spikes, consider expanding the storage layer by adding more storage nodes to improve write performance.</p>
<ul>
<li><strong>Purpose</strong>: Assess whether to increase storage capacity or optimize storage performance.</li>
</ul></li>
</ul>
<h3 id="loki-distributor-metrics">2. <strong>Loki Distributor Metrics</strong></h3>
<ul>
<li><p><strong><code>loki_distributor_received_bytes_total</code></strong>:</p>
<p>Monitors the total volume of log data received by the Distributor. If data volume significantly increases, consider adjusting the sharding strategy or adding more Distributor instances.</p>
<ul>
<li><strong>Purpose</strong>: Adjust sharding strategy based on log traffic and dynamically manage sharding to distribute log data.</li>
</ul></li>
<li><p><strong><code>loki_distributor_ring_members</code></strong>:</p>
<p>Monitors the number of Ingesters actively handling log traffic in Loki's sharding model. If the number of active members is lower than expected (e.g., some Ingester nodes have crashed), consider increasing the number of Ingester replicas.</p>
<ul>
<li><strong>Purpose</strong>: Scale up or down the number of Ingester replicas based on the number of active Ingesters.</li>
</ul></li>
<li><p><strong><code>loki_distributor_accepted_requests_total</code></strong> and <strong><code>loki_distributor_rejected_requests_total</code></strong>:</p>
<p>Monitors the number of accepted and rejected requests. Rejected requests may indicate that the system is overloaded, and additional capacity may be necessary.</p>
<ul>
<li><strong>Purpose</strong>: Adjust replicas and load distribution based on the count of rejected requests and system load.</li>
</ul></li>
</ul>
<h3 id="loki-querier-metrics">3. <strong>Loki Querier Metrics</strong></h3>
<ul>
<li><p><strong><code>loki_querier_request_duration_seconds</code></strong>:</p>
<p>Monitors query response times. If query response times increase, it may indicate high query load, in which case you may need to scale up the number of Querier instances.</p>
<ul>
<li><strong>Purpose</strong>: Dynamically add Querier instances to handle more query requests and reduce response times.</li>
</ul></li>
<li><p><strong><code>loki_querier_requests_total</code></strong>:</p>
<p>Monitors the total number of query requests. If the query volume becomes too high, it could slow down the system, so consider increasing the number of Querier replicas.</p>
<ul>
<li><strong>Purpose</strong>: Scale Querier instances up or down based on query volume to improve response speed.</li>
</ul></li>
</ul>
<h3 id="storage-metrics">4. <strong>Storage Metrics</strong></h3>
<ul>
<li><p><strong><code>loki_chunk_store_writes_total</code></strong> and <strong><code>loki_chunk_store_read_duration_seconds</code></strong>: Monitors chunk data read/write time and frequency in storage. High write frequency or increased read time may indicate a storage performance bottleneck, necessitating either additional storage capacity or optimized storage strategies.</p>
<ul>
<li><strong>Purpose</strong>: Adjust storage configuration and add storage nodes to minimize storage bottlenecks affecting query or write performance.</li>
</ul></li>
</ul>
<h3 id="system-level-resource-monitoring">5. <strong>System-Level Resource Monitoring</strong></h3>
<ul>
<li><p><strong>CPU and Memory Usage</strong>: Using <strong>Prometheus</strong> or Kubernetes' native monitoring tools (like HPA or VPA), monitor CPU and memory usage for Loki components (e.g., Ingester, Distributor, Querier). If resource usage for any component approaches its limits, consider horizontally scaling the number of replicas for that component.</p>
<ul>
<li><strong>Purpose</strong>: Dynamically adjust replicas based on CPU and memory usage.</li>
</ul></li>
</ul>
<h3 id="high-availability-monitoring">6. <strong>High Availability Monitoring</strong></h3>
<ul>
<li><p><strong><code>loki_ring_members</code></strong>: Monitors the number of nodes in Loki's sharding ring, ensuring all nodes in the cluster are active. If node count decreases, consider rebalancing the shards or adding more instances to compensate for lost nodes.</p>
<ul>
<li><strong>Purpose</strong>: Dynamically adjust high-availability configurations based on ring member count.</li>
</ul></li>
</ul>
<h3 id="dynamic-adjustment-mechanisms">Dynamic Adjustment Mechanisms:</h3>
<h3 id="replica-based-dynamic-scaling">1. <strong>Replica-Based Dynamic Scaling</strong>:</h3>
<ul>
<li><p>When metrics like <code>loki_ingester_memory_usage_bytes</code> or <code>loki_distributor_received_bytes_total</code> indicate high load, you can dynamically increase <code>replicas</code> by using <code>kubectl scale</code> or HPA (Horizontal Pod Autoscaler) to adjust instance numbers based on real-time load.</p></li>
<li><p>Example: Use HPA to automatically scale Promtail, Ingester, or Querier instances:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl autoscale statefulset loki-ingester --min=3 --max=10 --cpu-percent=80</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="sharding-based-dynamic-scaling">2. <strong>Sharding-Based Dynamic Scaling</strong>:</h3>
<ul>
<li><p>When metrics like <code>loki_distributor_received_bytes_total</code> or <code>loki_ingester_chunk_store_writes_total</code> show a surge in log traffic, adjust the <code>shard_by_all_labels</code> configuration or use the <code>sharding</code> parameter in Loki’s configuration to dynamically increase the number of log shards.</p></li>
<li><p>Example: Increase <code>shard</code> count for Distributors and Ingesters to distribute more log data across multiple Ingester nodes.</p></li>
</ul>
<p>These metrics can be easily collected with Prometheus and displayed in Grafana. Combined with Loki's configuration adjustments, they enable real-time dynamic configuration optimization to ensure system performance and stability in high-concurrency environments.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/29/loki_scalability/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin Shao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Justin Shao's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/29/loki_scalability/" class="post-title-link" itemprop="url">Loki System Scalability</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-10-29 21:40:00 / Modified: 23:17:43" itemprop="dateCreated datePublished" datetime="2024-10-29T21:40:00+08:00">2024-10-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre class="mermaid">graph TD
    subgraph Loki Stack
        A[Client] -->|Push Logs| B[Distributor]
        B -->|Distribute Logs| C[Ingester]
        C -->|Store Logs| D[Chunk Store]
        E[Querier] -->|Fetch Logs| D
        F[Query Frontend] -->|Distribute Queries| E
        G[Client] -->|Query Logs| F
    end

    subgraph External Systems
        H[Promtail] -->|Send Logs| A
        I[Grafana] -->|Visualize Logs| G
    end</pre>
<h2 id="components-description"><strong>Components Description</strong></h2>
<ul>
<li><strong>Distributor</strong>: Receives log data from clients and distributes it to the ingesters.</li>
<li><strong>Ingester</strong>: Processes and stores log data temporarily before it is flushed to the chunk store.</li>
<li><strong>Chunk Store</strong>: A long-term storage solution for log data, such as an object store (e.g., S3, GCS).</li>
<li><strong>Querier</strong>: Fetches log data from the chunk store to respond to user queries.</li>
<li><strong>Query Frontend</strong>: Distributes incoming queries to multiple queriers for load balancing and parallel processing.</li>
<li><strong>Promtail</strong>: A log collection agent that sends logs to the Loki distributor.</li>
</ul>
<h2 id="interaction-flow"><strong>Interaction Flow</strong></h2>
<ol type="1">
<li><strong>Log Ingestion</strong>:
<ul>
<li>Logs are sent from the <strong>Client</strong> to the <strong>Distributor</strong>.</li>
<li>The <strong>Distributor</strong> distributes the logs to multiple <strong>Ingesters</strong>.</li>
<li><strong>Ingesters</strong> process and temporarily store the logs before flushing them to the <strong>Chunk Store</strong>.</li>
</ul></li>
<li><strong>Log Storage</strong>:
<ul>
<li><strong>Ingesters</strong> periodically flush processed logs to the <strong>Chunk Store</strong> for long-term storage.</li>
</ul></li>
<li><strong>Log Querying</strong>:
<ul>
<li><strong>Clients</strong> (e.g., Grafana) send queries to the <strong>Query Frontend</strong>.</li>
<li>The <strong>Query Frontend</strong> distributes the queries to multiple <strong>Queriers</strong>.</li>
<li><strong>Queriers</strong> fetch the required log data from the <strong>Chunk Store</strong> and return it to the <strong>Client</strong>.</li>
</ul></li>
</ol>
<h2 id="optimization-actions-for-high-concurrency-log-processing-and-storage-scalability">Optimization Actions for High-Concurrency Log Processing and Storage Scalability</h2>
<pre class="mermaid">graph TD
    %% Clients and Log Collection
    Client[Clients / Applications] -->|Send Logs| Promtail[Promtail]
    
    %% Ingestion Pipeline
    Promtail -->|Push Logs| Distributor[Distributor Cluster]
    Distributor -->|Distribute to| Ingesters[Ingester Cluster]
    
    %% Storage Layers
    Ingesters -->|Write to| Storage["Object Storage<br/> (S3, GCS, etc.)"]
    Ingesters -->|Maintain Temporary Data| Cache[In-Memory Cache]
    
    %% Query Pipeline
    Querier[Querier Cluster] -->|Fetch from Storage| Storage
    Querier -->|Retrieve from Cache| Cache
    Querier -->|Access Index| Index[Index Gateway]
    
    %% Compaction and Maintenance
    Compactor[Compactor] -->|Compact Data| Storage
    
    %% Alerting and Visualization
    Ruler[Ruler] -->|Fetch Rules| Storage
    Ruler -->|Evaluate Alerts| Querier
    Grafana[Grafana] -->|Visualize Logs| Querier
    Grafana -->|Manage Alerts| Ruler
    
    %% Additional Interactions
    Ingesters -->|Send Metrics| Metrics[Metrics & Monitoring]
    Querier -->|Send Metrics| Metrics
    Distributor -->|Send Metrics| Metrics
    Promtail -->|Send Metrics| Metrics
    Ruler -->|Send Metrics| Metrics
    Compactor -->|Send Metrics| Metrics
    Grafana -->|Display Metrics| Metrics</pre>
<h3 id="horizontal-scaling-of-log-collection-promtail">1. <strong>Horizontal Scaling of Log Collection: Promtail</strong></h3>
<ul>
<li><strong>Action</strong>: Increase the number of Promtail instances to handle the load of log collection in a high-concurrency environment. Promtail is Loki's log collection agent, responsible for gathering logs from various nodes.</li>
<li><strong>Implementation</strong>:
<ul>
<li>In a Kubernetes cluster, configure Promtail as a DaemonSet to ensure an instance runs on each node, enabling automatic scaling across all nodes for comprehensive log collection.</li>
<li>When workload increases in the cluster, dynamically adjust the number of Promtail instances to prevent log collection from becoming a bottleneck. Use Kubernetes Horizontal Pod Autoscaling (HPA) to scale Promtail instances up or down based on log collection load.</li>
</ul></li>
<li><strong>Key Technology</strong>: Utilize Kubernetes load balancing to evenly distribute logs from different nodes to Promtail instances, in combination with HPA for dynamic scaling.</li>
</ul>
<h3 id="sharding-and-partitioning-strategy-for-loki-storage-layer">2. <strong>Sharding and Partitioning Strategy for Loki Storage Layer</strong></h3>
<ul>
<li><strong>Action</strong>: To address storage bottlenecks, implement sharding and partitioning strategies at the Loki storage layer, distributing logs across multiple storage nodes to enhance write throughput.</li>
<li><strong>Implementation</strong>:
<ul>
<li>Configure the storage layer (e.g., using S3 or MinIO) in Loki for distributed storage, using sharding and partitioning to spread logs across various storage nodes. Each node handles only part of the data, reducing write pressure on individual nodes.</li>
<li>Specify multiple storage targets in Loki's configuration, allowing horizontal scaling across multiple physical or virtual storage nodes to improve fault tolerance and storage performance.</li>
</ul></li>
</ul>
<h3 id="parallel-processing-ingester">3. <strong>Parallel Processing: Ingester</strong></h3>
<ul>
<li><strong>Action</strong>: The Ingester component in Loki is responsible for receiving and processing log data. In high-concurrency environments, increase the number of Ingester instances to enable parallel log processing.</li>
<li><strong>Implementation</strong>:
<ul>
<li>Increase the number of Ingester instances, with each instance handling a portion of the log data. By introducing sharding, each Ingester processes only part of the log stream, avoiding overload on individual instances.</li>
<li>Deploy Loki using Kubernetes StatefulSets and leverage Loki's replication and consistency model to ensure log data processing continuity even if some Ingester nodes fail.</li>
</ul></li>
</ul>
<h3 id="monitoring-and-dynamic-adjustment-prometheus-monitoring-and-scaling-strategy">4. <strong>Monitoring and Dynamic Adjustment: Prometheus Monitoring and Scaling Strategy</strong></h3>
<ul>
<li><strong>Action</strong>: To ensure dynamic adjustment capabilities, design a real-time monitoring and auto-scaling strategy based on Prometheus.</li>
<li><strong>Implementation</strong>:
<ul>
<li>Use Prometheus to monitor load metrics for each component of the Loki Stack (e.g., Promtail, Ingester, Querier), including log collection throughput and storage latency.</li>
<li>Based on monitored metrics, dynamically adjust the number of Promtail and Ingester instances, scaling up during peak periods and scaling down during lower loads to save costs.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://shaorui0.github.io/2024/10/29/monitoring_loki/">Monitoring metrics</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Justin Shao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/shaorui0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shaorui0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:sr1054461216@gmail.com" title="E-Mail → mailto:sr1054461216@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Justin Shao</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

</body>
</html>
